
	
	
	
	
	
	
	
	
	
	
	<wxr-world><!--새노즐과 금속판에 위치한 트리거를 새노즐과 금속판 충돌로 바꾼다.-->
<!--위 충돌 발생시 moveTo를 이용해 중앙쪽으로 가도록 일단 해둠-->
<!--추후, 다른 방안? 노즐이 내려오면 더 이상 내려가지 못하도록 y좌표만 조정하는 방안을 생각해 볼 수있음 이렇게 할 경우에 연필(4_2)을 노즐파트(1_1)에 append 필요-->
<!--연필 모델 정교한 계산이 이루어진 것으로 교체-->

<script src="https://cdn.rawgit.com/webcomponents/webcomponentsjs/v1.1.0/webcomponents-lite.js"></script>
<link href="https://libs.webizing.org/wxr-0.8.html" rel="import">

<script>

window.addEventListener('WebComponentsReady',function()
{
WXR.WebizingDeviceConfigManager.webizingDeviceManagerEnable=false;WXR.InteractionListener.webizingDeviceManagerEnable=false;WXR.InteractionListener.interactionEventServerEnable=false;
}
);

</script>

<style id="internal">

wxr-camera
{
--wxr-transform:translate3d(0,0.1,2.6)rotate3d(0,0,0);
}
wxr-light-ambient
{
--wxr-transform:translate3d(0,0,0)rotate3d(0,0,0)scale3d(1,1,1);
}
#target0
{
--wxr-transform:translate3d(0,0,0)rotate3d(0,0,0)scale3d(1,1,1);
}
#target1
{
--wxr-transform:translate3d(0,0,0)rotate3d(0,0,0)scale3d(1,1,1);
}
#target2
{
--wxr-transform:translate3d(-0.00125794,-0.21579,0.0531772)rotate3d(0,0,0)scale3d(1,1,1);
}
#target3
{
--wxr-transform:translate3d(0.249956,-0.21579,0.0531772)rotate3d(0,0,0)scale3d(1,1,1);
}
#target4
{
--wxr-transform:translate3d(-0.0999487,-0.524552,0.296761)rotate3d(0,0,0)scale3d(1,1,1);
}
#model0_1
{
--wxr-transform:translate3d(0,0,0)rotate3d(0,0,0)scale3d(1,1,1);
}
#model1_1
{
--wxr-transform:translate3d(0,-0.2148550464118157,0.053593716449699125)rotate3d(0,0,0)scale3d(1,1,1);
}
#model1_2
{
--wxr-transform : translate3d(0,0.0787986341506225,0.0357455590428265) rotate3d(0,0,0) scale3d(1,1,1);
}
#model2_1
{
--wxr-transform:translate3d(0.000531987,0,0)rotate3d(0,0,0)scale3d(1.3,1.3,1.3);
}
#model2_2
{
/*--wxr-transform:translate3d(0,-0.025,0)rotate3d(0,-2.8688139666518917,0)scale3d(1,1,1);*/--wxr-transform:translate3d(0,-0.025,0)rotate3d(-3.1415,0,0)scale3d(1,1,1);
}
#model3_1
{
--wxr-transform:translate3d(0,0,0)rotate3d(0,0,0)scale3d(1.3,1.3,1.3);/*후에원판에닿게될경우어느위치로닿아야하는지?--wxr-transform:translate3d(-0.2690694024220521,-0.16538263005820542,0.18721739376840563)rotate3d(0,0,0)scale3d(1,1,1);*/
}
#model3_2
{
--wxr-transform:translate3d(0,-0.035,0)rotate3d(0,-3.2160582666727136,0)scale3d(1,1,1);
}
#model4_1
{
--wxr-transform:translate3d(0,0,0)rotate3d(0,0,0)scale3d(1,1,1);
}
#model4_2
{
--wxr-transform:translate3d(0,0.030884,0)rotate3d(0,-2.932197562501646,0)scale3d(1.5,1.5,1.5);
}
#triggerTarget
{
--wxr-transform:translate3d(-0.00125794,-0.21579,0.0531772)rotate3d(0,0,0)scale3d(1.3,1.3,1.3);
}
#triggerTarget2
{
--wxr-transform:translate3d(-0.00125794,-0.21579,0.0531772)rotate3d(0,0,0)scale3d(1.3,1.3,1.3);
}
#triggerTarget3
{
--wxr-transform:translate3d(-0.0999487,-0.5013499257048857,0.296761)rotate3d(0,0,0)scale3d(1.3,1.3,1.3);
}


</style>

<wxr-user user-id="jisoo.lee@wrl.onl" authority="owner" me=""></wxr-user>

<wxr-description title="insstek AR" img="https://wxr.nyc3.digitaloceanspaces.com/ar3dp/thumb/ar-thumb.png" desc="insstek 3D printer maintenance using WXR AR browser"></wxr-description>
<wxr-view default="3D" current="3D" modes="[&quot;3D&quot;,&quot;AR&quot;,&quot;VR&quot;]"></wxr-view>
<wxr-ar engine="vuforia"></wxr-ar>

<wxr-camera fovy="61" near="0.05000024999875001" far="10000.099999934488" fov="63.5824998097939" aspect="1.7053669222343921"></wxr-camera>
<wxr-space src="http://content.wxr.webizing.org/space/1" augbase="https://wxr.nyc3.digitaloceanspaces.com/ar3dp/target/test/stones" webgl_uuid="76A993D1-B1F1-4682-84AF-C6EF39D69F48" css3d_uuid="9448EAA4-16DC-43AC-9334-EAA1C8EE0053" id="null">
  
  
  <script> 
/*
    var step2=false;
    var step3=false;
        function onCollide(box, result){
            for(var i=0; i<result.length; i++){
              console.log(result[i]);
                if(result[i]==$("#model1_1")[0] && !step2){
                  alert('nozzle_attatch');
                    step2 = true;
                }
                else if(result[i]==$("#model4_1")[0] && !step3){
                  alert('plate collision');
                  step3 = true;
                  box.oncollide="";
                }
            }
        }
*/      

       function collision1(trigger, target){
              const distance = trigger.webGLObject3D.getWorldPosition().distanceTo(target.webGLObject3D.getWorldPosition());
              return distance < 0.01 ? true : false;
       }
       function collision2(trigger, target){
              const distance = trigger.webGLObject3D.getWorldPosition().distanceTo(target.webGLObject3D.getWorldPosition());
              return distance < 0.08 ? true : false;
       }
       function action1(trigger, target){
          //alert('first collision!');
            $('#model1_1')[0].append($('#model3_1')[0]) //parent : nozzle part, child : new nozzle
            $('#model3_1')[0].moveTo(0,0,0) 

            $('#model3_2').remove();
            $('#model1_1')[0].startAnimation();

            trigger.ontrigger="";
       }
       function action2(trigger, target){
          //alert('second collison!');
             $('#model4_1')[0].append($('#model1_1')[0])
            //plate - nozzle part collision detection : move nozzle to center of the plate ======================================================================check again
            $('#model1_1')[0].moveTo(0.0013710626139013, 0.094552, 0.0009961944775313) 
          
      
          //appear pencil and start animation
            $('#model4_2')[0].changedDomStyleDisplay('block'); 
            $('#model4_2')[0].startAnimation();
         
          var x11 = $('#model1_1')[0].webGLObject3D.getWorldPosition().x;
          var y11 = $('#model1_1')[0].webGLObject3D.getWorldPosition().y;
          var z11 = $('#model1_1')[0].webGLObject3D.getWorldPosition().z;
                         
            setTimeout(function() {
            $('#model4_2')[0].changedDomStyleDisplay('none'); 
                setTimeout(function(){
                  //before show the wrench, move it to appropriate position 
                  $('#model1_2')[0].moveTo(x11, y11 + 0.0787986341506225, z11 + 0.0357455590428265); 
                  $('#model1_2')[0].changedDomStyleDisplay('block');
                  $('#model1_2')[0].startAnimation();

                }, 1000);
            }, 15000); 
            //Wait for pencil animation and pause for 1 second
          //After that, hide pencil and appear hex wrench
           

            trigger.ontrigger="";
       }

       //default settings
       function action0(object){
   
           $('#model2_1')[0].append($('#model2_2')[0])  //parent : destroyed, child : rotation arrow
           $('#model3_1')[0].append($('#model3_2')[0])  //parent : new, child : rotation arrow
           //$('#model1_1')[0].append($('#model1_2')[0])  //parent : nozzle part, child : hex wrench
           //$('#model1_2')[0].moveTo(0, 0.0787986341506225, 0.0357455590428265) 
          
       $('#model1_2')[0].changedDomStyleDisplay('none');  //hide hex wrench 
           $('#model4_2')[0].changedDomStyleDisplay('none');  //hide pencil   

            
           object.oncollide="";
       }

        //replace "function action2" to "function onCollide" ????? ==>(X)
/*        function onCollide(object, result){
            var count=1;
            for(var i=0; i<result.length; i++){
                if(result[i]==$("#model4_1")[0] && count==4){

                    $('#model4_2')[0].changedDomStyleDisplay('block'); 
                    $('#model4_2')[0].startAnimation();
                    setTimeout(function() {
                    $('#model4_2')[0].changedDomStyleDisplay('none'); 
                        setTimeout(function(){
                          $('#model1_2')[0].changedDomStyleDisplay('block');
                        }, 1000);
                    }, 15000); 
                    count++;  
                    object.oncollide="";
                }
            }

        }
*/
    </script> 

    
    <wxr-target id="target0" src="https://wxr.nyc3.digitaloceanspaces.com/ar3dp/target/nozzle/remove_nozzle" webgl_uuid="EE00873E-A9C4-4049-9C42-452FE5E1E31A" css3d_uuid="70BDED02-060F-486A-AABD-F5B6BDC73B26" observetrigger="true">
        <wxr-light-ambient color="0xf0f0f0" intensity="0.3" webgl_uuid="F1B73D5D-A225-4E47-9687-1B5EFF59EC10" css3d_uuid="AD804B68-4393-4A8E-87CC-F43FC6C15BCE"></wxr-light-ambient>
        <wxr-light-directional color="0xf0f0f0" intensity="0.5" webgl_uuid="68F31182-AAB9-4B2C-A786-9914D8C22A4C" css3d_uuid="281FDDED-8708-4C1B-AC0D-1E9504761B83"></wxr-light-directional> 
        
        <!--simple printer-->
        <wxr-obj id="model0_1" mtl="s_printer.mtl" obj="s_printer.obj" base-url="https://wxr.nyc3.digitaloceanspaces.com/ar3dp/resources/models/nozzle" webgl_uuid="CE8CDD58-2951-46FE-8336-3AA49731B29A" css3d_uuid="D958FB44-CB41-45B5-9324-3022D22220FE" observetrigger="true">
        </wxr-obj>
    </wxr-target>
    
  
    <wxr-target id="target1" src="https://wxr.nyc3.digitaloceanspaces.com/ar3dp/target/nozzle/nozzle_part" webgl_uuid="AA0884ED-198B-4A84-8E10-3B82E23CB68D" css3d_uuid="02F17389-42C6-46DF-802D-48D77733F534" observetrigger="true">
<!--        <wxr-obj id="model1_1" mtl="nozzle_part.mtl" obj="nozzle_part.obj" base-url="https://wxr.nyc3.digitaloceanspaces.com/ar3dp/resources/models/nozzle" observetrigger="true" collisionmesh="true" collisionradius="0.05" oncollide="action0(this)" disable-animation-auto-start="" webgl_uuid="65B5022C-1D35-4F4E-B638-3F6B9F50696E" css3d_uuid="E92C6ABA-C5EC-4FF3-BC20-639B3732C9C7"> 
        <wxr-animation type="movement" to="-0.0985776373860987 -0.2102909056489448 0.2441634944775313" duration="5000" repeat="2" easing="linear"></wxr-animation>
-->     
    <!--nozzle part : apply animation moving by x,y,z axis -->
    <wxr-obj id="model1_1" mtl="nozzle_part.mtl" obj="nozzle_part.obj" base-url="https://wxr.nyc3.digitaloceanspaces.com/ar3dp/resources/models/nozzle" observetrigger="true" collisionmesh="true" collisionradius="0.05" oncollide="action0(this)" disable-animation-auto-start="" animationrepeat="2" webgl_uuid="894BE9F9-4F71-44D1-B568-D28318857F24" css3d_uuid="CEFED1CC-03AF-4E9A-8258-E46CC5B24534">
      <wxr-animation type="movement" to="0 0 0.2441634944775313" duration="1500" easing="linear"></wxr-animation>
        <wxr-animation type="movement" to="-0.0985776373860987 0 0" duration="1500" easing="linear"></wxr-animation>
        <wxr-animation type="movement" to="0 -0.2102909056489448 0" duration="1500" easing="linear"></wxr-animation>
    </wxr-obj>  
    <wxr-obj id="model1_2" mtl="hexkey2.mtl" obj="hexkey2.obj" base-url="https://wxr.nyc3.digitaloceanspaces.com/ar3dp/resources/models/nozzle" observetrigger="true" disable-animation-auto-start="" webgl_uuid="DA4914F2-0071-4EF5-9196-38FA6F09AF5F" css3d_uuid="576E5A63-4B6A-43AF-8E3A-0667806F12FC">
  
        <wxr-animation type="helix" to="0 0 0.01 0 0 -6.2831" repeat="4" duration="5000"></wxr-animation>     
    </wxr-obj>
      
      <script>       $('#model1_2')[0].changedDomStyleDisplay('none');  //hide hex wrench 
</script>
      

  <!--hex wrench-->   
    <!--<wxr-obj id="model1_2" mtl="hexkey2.mtl" obj="hexkey2.obj" base-url="https://wxr.nyc3.digitaloceanspaces.com/ar3dp/resources/models/nozzle" observetrigger="true" disable-animation-auto-start="" webgl_uuid="956BCBC2-E1AA-41D3-9606-0E09ADE29A99" css3d_uuid="C06926E3-CC13-48EA-82B5-545165899712">-->
    
        
  </wxr-target>
  
  
  <wxr-target id="target2" src="https://wxr.nyc3.digitaloceanspaces.com/ar3dp/target/nozzle/destroyed_nozzle" webgl_uuid="4383251C-2AF7-4FF5-A968-3463CC6FFA8A" css3d_uuid="DD07403B-9EAE-4703-9741-19FECB13011A" observetrigger="true">
        
    <script>
        function isFaraway(trigger, target){  //check distance between nozzle part and destroyed nozzle
          const distance = trigger.webGLObject3D.getWorldPosition().distanceTo(target.webGLObject3D.getWorldPosition());
          return distance > 0.15 ? true : false;
        }
        function removeTarget(target){  //If destroyed nozzle is far enough from nozzle part, discard destroyed nozzle and rotational arrow.
          //alert('far away~~~');
          $('#model2_1').remove();
          $('#model2_2').remove();
          //target.ontrigger="";
        }
    </script>
    
    <!--destroyed nozzle-->
    <wxr-obj id="model2_1" mtl="destroyed.mtl" obj="destroyed.obj" base-url="https://wxr.nyc3.digitaloceanspaces.com/ar3dp/resources/models/nozzle" observetrigger="true" collisionmesh="true" webgl_uuid="57AEEEB8-44FF-4A99-A213-CDF2A41934A3" css3d_uuid="74860081-6773-4CE9-A0BC-9E547F0B1E2A">
    
    <!--rotation arrow(clockwise)-->  
    <wxr-obj id="model2_2" mtl="rotate.mtl" obj="rotate.obj" base-url="https://wxr.nyc3.digitaloceanspaces.com/ar3dp/resources/models/nozzle" observetrigger="true" webgl_uuid="E69E2FC9-8E9B-49B8-A680-5F82E7FA7957" css3d_uuid="B2A0D9C5-30D5-4E67-84F0-6BA9A16F653F">
      <wxr-animation type="rotation" to="0 -6.2830 0" duration="3000" repeat="Infinity" easing="linear"></wxr-animation>   
    </wxr-obj></wxr-obj>
          
  </wxr-target>
  
  
  <wxr-target id="target3" src="https://wxr.nyc3.digitaloceanspaces.com/ar3dp/target/nozzle/new_nozzle" webgl_uuid="BE323690-DEE7-43DE-BAFD-B3B396DD2189" css3d_uuid="7FBE9D93-2C86-4922-868D-F209772BAF4E" observetrigger="true">
    <!--new nozzle-->
    <wxr-obj id="model3_1" mtl="new.mtl" obj="new.obj" base-url="https://wxr.nyc3.digitaloceanspaces.com/ar3dp/resources/models/nozzle" observetrigger="true" webgl_uuid="C11B67F3-90BF-42DC-9D95-51385B9DD92E" css3d_uuid="453F7C1B-83BC-4097-BF84-D7BE1CC39610">
    <wxr-obj id="model3_2" mtl="rotate.mtl" obj="rotate.obj" base-url="https://wxr.nyc3.digitaloceanspaces.com/ar3dp/resources/models/nozzle" observetrigger="true" webgl_uuid="F01D2657-7C10-4F68-9215-75834468D3F4" css3d_uuid="1E7FF7F0-6689-49EF-9925-D2EB274C3FE3">
      <wxr-animation type="rotation" to="0 -6.2830 0" duration="3000" repeat="Infinity" easing="linear"></wxr-animation>
    </wxr-obj></wxr-obj>
    <!--rotation arrow(counter clockwise)-->  
    
      
  </wxr-target>

  <wxr-target id="target4" src="https://wxr.nyc3.digitaloceanspaces.com/ar3dp/target/nozzle/plate" webgl_uuid="3E3F4B31-A4C8-4781-BE26-FAD1F1CAB1BC" css3d_uuid="FBCA267F-9810-417F-A7A1-E013C574C52E" observetrigger="true">
    <!--plate-->  
  <wxr-obj id="model4_1" mtl="plate.mtl" obj="plate.obj" base-url="https://wxr.nyc3.digitaloceanspaces.com/ar3dp/resources/models/nozzle" webgl_uuid="9B764886-F511-4943-B129-A67EA9AB1265" css3d_uuid="80DF7204-F030-4A19-947B-1DC586E9FB5F" observetrigger="true">
    </wxr-obj>
    <!--pencil-->
    <wxr-obj id="model4_2" mtl="pencil4.mtl" obj="pencil4.obj" base-url="https://wxr.nyc3.digitaloceanspaces.com/ar3dp/resources/models/nozzle" observetrigger="true" disable-animation-auto-start="" webgl_uuid="5E3F3ED7-2013-4FD7-A50C-6C0EB9ACE01D" css3d_uuid="EECC177A-8540-4768-9D4E-3E3F481CA936"><!-- disable-animation-auto-start="" >-->
      <wxr-animation type="rotation" to="0 -6.2830 0" duration="5000" repeat="Infinity" easing="linear"></wxr-animation>
    </wxr-obj>
  </wxr-target>
  

  <wxr-trigger id="triggerTarget" targets="[&quot;model2_1&quot;]" condition="isFaraway(this,target)" ontrigger="removeTarget(this, target)"></wxr-trigger> <!--Nozzle part and Destroyed nozzle : check "isFaraway"-->   
  <wxr-trigger id="triggerTarget2" targets="[&quot;model3_1&quot;]" condition="collision1(this, target)" ontrigger="action1(this, target)"></wxr-trigger> <!--Nozzle part and New nozzle : check "collision1"-->
  <wxr-trigger id="triggerTarget3" targets="[&quot;model1_1&quot;]" condition="collision2(this, target)" ontrigger="action2(this, target)" observetrigger="true"></wxr-trigger> <!--Plate and Nozzle part : check "collision2"-->

  </wxr-space>


</wxr-world>
	


	


	


	


	


	


	


	


	


	


	

